---
title: "Final Project"
author: "Bernard A. Coles IV"
date: "5/2/2019"
output:
  pdf_document: default
---

```{r Loading the Data, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
library(tidyverse)
library(dplyr)
library(gridExtra)
library(grid)
library(rethinking)
library(kableExtra)
library(ggthemes)
library(knitr)
library(broom)
library(brms)
library(loo)
library(bayesplot)
library(dotwhisker)
library(GGally)

#Windows
#load("E:/Repository/Biso/Biso/data/wave1.rda")
#load("E:/Repository/Biso/Biso/data/network.wave1.rda")
#load("E:/Repository/Biso/Biso/data/weights.rda")

#Mac
load("~/desktop/Repository/Biso/data/wave1.rda")
load("~/desktop/Repository/Biso/data/network.wave1.rda")
load("~/desktop/Repository/Biso/data/weights.rda")

#Renamed
wave1.data <- da21600.0001
network.data <- da21600.0003
weights <- da21600.0004

#Merging Relevant Variables into one Data Frame
data1 <- wave1.data %>%
  dplyr :: select(AID, H1FV2, H1FV3, H1FV4, H1FV6, S6A, S6B, S6C, S6D, S6E, S4, S1, S2, PA55, H1FV9)

data2 <-  network.data %>%
  dplyr :: select(AID, ESRDEN, BCENT10X, IDGX2, SEG1RCE5, ERNRC5, EHRC5, AXS59A, AXS59B, AXS59C, AXS59D, AXS59E, AXS59F, AXS59G, SRCE51, SRCE52, SRCE53, SRCE54, SRCE55)

data3 <- weights %>%
  dplyr :: select(AID, GSWGT1)

mydata <- merge(data1, data2, by = "AID") 
#mydata <- merge(my.data, data3, by = "AID")

rm(da21600.0001, da21600.0003, da21600.0004, data1, data2, data3, wave1.data, network.data, weights)
```

```{r Data Cleaning, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
#Race variable
mydata <- mydata %>%
  mutate(race = case_when(
    (S4 == "(1) (1) Yes (go to Q.5)" & S6A == "(1) (1) Marked") ~ "white latino",
    (S4 == "(1) (1) Yes (go to Q.5)" & S6B == "(1) (1) Marked") ~ "black latino",
    (S6A == "(1) (1) Marked" & S6B== "(1) (1) Marked") ~ "mixed race",
    (S6A == "(1) (1) Marked" & S6C == "(1) (1) Marked") ~ "mixed race",
    (S6A == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
    (S6A == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
    (S6B == "(1) (1) Marked" & S6C == "(1) (1) Marked") ~ "mixed race",
    (S6B == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
    (S6B == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
    (S6C == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
    (S6C == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
    (S6D == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
    S4 == "(1) (1) Yes (go to Q.5)" ~ "latino", 
    S6A == "(1) (1) Marked" ~ "white",
    S6B == "(1) (1) Marked" ~ "black", 
    S6C == "(1) (1) Marked" ~ "asian", 
    S6D == "(1) (1) Marked" ~ "native american", 
    S6E == "(1) (1) Marked" ~ "other",
    T ~ NA_character_))

#Victimization
mydata <- mydata %>%
  mutate(victim = case_when(
    (H1FV2 == "(1) (1) Once" |  H1FV2 == "(2) (2) More than once") ~ 1,
    (H1FV3 == "(1) (1) Once" |  H1FV3 == "(2) (2) More than once") ~ 1,
    (H1FV4 == "(1) (1) Once" |  H1FV4 == "(2) (2) More than once") ~ 1,
    (H1FV6 == "(1) (1) Once" |  H1FV6 == "(2) (2) More than once") ~ 1,
    H1FV2 == "(0) (0) Never" ~ 0,
    H1FV3 == "(0) (0) Never" ~ 0,
    H1FV4 == "(0) (0) Never" ~ 0,
    H1FV6 == "(0) (0) Never" ~ 0,
    T ~ NA_real_))
#Dependent Variable Breakdown Table 
mydata <- mydata %>%
  mutate(knife.gun = case_when(
    (H1FV2 == "(1) (1) Once" |  H1FV2 == "(2) (2) More than once") ~ 1,
    H1FV2 == "(0) (0) Never" ~ 0,
    T ~ NA_real_))
mydata <- mydata %>%
  mutate(shot = case_when(
    (H1FV3 == "(1) (1) Once" |  H1FV3 == "(2) (2) More than once") ~ 1,
    H1FV3 == "(0) (0) Never" ~ 0,
    T ~ NA_real_))
mydata <- mydata %>%
  mutate(stabbed = case_when(
    (H1FV4 == "(1) (1) Once" |  H1FV4 == "(2) (2) More than once") ~ 1,
    H1FV4 == "(0) (0) Never" ~ 0,
    T ~ NA_real_))
mydata <- mydata %>%
  mutate(jumped = case_when(
    (H1FV6 == "(1) (1) Once" |  H1FV6 == "(2) (2) More than once") ~ 1,
    H1FV6 == "(0) (0) Never" ~ 0,
    T ~ NA_real_))

#Creating the Network Delinquency Variable
mydata <- mydata %>%
  mutate(network.delinquency = (AXS59A + AXS59B + AXS59C + AXS59D + AXS59E + AXS59F + AXS59G)/7) 

#Cleaning Control Variables 
mydata <- mydata %>%
  mutate(female = case_when(
    S2 == "(1) (1) Male" ~ 0,
    S2 == "(2) (2) Female" ~ 1,
    T ~ NA_real_))

mydata$age <- mydata$S1
mydata$family.income <- mydata$PA55


mydata <- mydata %>%
  mutate(weapon.carry = case_when(
    H1FV9 == "(0) (0) None (skip to Q.11)" ~ 0, 
    (H1FV9 == "(1) (1) 1 day" | H1FV9 == "(2) (2) 2 or 3 days" | H1FV9 == "(3) (3) 4 or 5 days" | H1FV9 == "(4) (4) 6 or more days") ~ 1,
    T ~ NA_real_))

#Renaming Network Variables
mydata$racial.heterogeneity <- mydata$ERNRC5
mydata$dense <- mydata$ESRDEN
mydata$centrality <- mydata$BCENT10X
mydata$popularity <- mydata$IDGX2

mydata <- mydata %>%
  mutate(den = case_when(
    (popularity == 0 & centrality == 0) ~ 0,
    T ~ dense))


mydata <- mydata %>%
  mutate(density = den*100)

#Variable Selection 
mydata.dv <- mydata %>%
  select(knife.gun, shot, stabbed, jumped)

mydata <- mydata %>%
  select(AID, victim, race, female, age, family.income, weapon.carry, racial.heterogeneity, network.delinquency, popularity, centrality, density)

#Only complete rows Kept
mydata.c <- mydata[complete.cases(mydata), ]
```

```{r BRM Models, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
model <- brm(data = mydata.c, family = binomial,
             victim | trials(1) ~ 1 + age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density, 
             prior = c(prior(normal(0, 10), class = Intercept), 
                       prior(normal(0, 10), class = b)), 
                       iter = 2500, warmup = 500, cores = 4, chains = 4, seed = 10)

imodel1 <- update(model, newdata = mydata.c, formula = victim | trials(1) ~ 1 + age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency:centrality)
             
imodel2 <- update(model, newdata = mydata.c, formula = victim | trials(1) ~ 1 + age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency:popularity)

imodel3 <- update(model, newdata = mydata.c, formula = victim | trials(1) ~ 1 + age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency:density)

```

```{r GLM Models, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
gmodel1 <- glm(victim ~ age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density, data = mydata.c, family = "binomial")
gm1.df <- tidy(gmodel1)

gmodel2 <- glm(victim ~ age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency*centrality, data = mydata.c, family = "binomial")
gm2.df <- tidy(gmodel2)

gmodel3 <- glm(victim ~ age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency*popularity, data = mydata.c, family = "binomial")
gm3.df <- tidy(gmodel3)

gmodel4 <- glm(victim ~ age + female + family.income + weapon.carry + racial.heterogeneity + network.delinquency + popularity + centrality + density + network.delinquency*density, data = mydata.c, family = "binomial")
gm4.df <- tidy(gmodel4)
```

```{r Effect Size Plots, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

#Tidying Models 
gm1 <- gm1.df %>%
  mutate(estimate = exp(estimate),  # Odds ratio
         var = diag(vcov(gmodel1)),  # Variance of each coefficient
         std.error = sqrt(estimate^2 * var)) %>% #Standard Errors of the ORs
  mutate(term = case_when(
    term == "(Intercept)" ~ "Intercept",
    term == "age" ~ "Age",
    term == "female" ~ "Sex",
    term == "family.income" ~ "Family Income",
    term == "weapon.carry" ~ "Weapon Carry",
    term == "racial.heterogeneity" ~ "Racial Heterogeneity",
    term == "network.delinquency" ~ "Network Delinquency",
    term == "popularity" ~ "Popularity",
    term == "centrality" ~ "Centrality",
    term == "density" ~ "Density",
    T ~ NA_character_)) %>%
  mutate(model = "Model 1") %>%
  select(term, estimate, std.error, model)

gm2 <- gm2.df %>%
  mutate(estimate = exp(estimate),  # Odds ratio
         var = diag(vcov(gmodel2)),  # Variance of each coefficient
         std.error = sqrt(estimate^2 * var)) %>% #Standard Errors of the ORs
  mutate(term = case_when(
    term == "(Intercept)" ~ "Intercept",
    term == "age" ~ "Age",
    term == "female" ~ "Sex",
    term == "family.income" ~ "Family Income",
    term == "weapon.carry" ~ "Weapon Carry",
    term == "racial.heterogeneity" ~ "Racial Heterogeneity",
    term == "network.delinquency" ~ "Network Delinquency",
    term == "popularity" ~ "Popularity",
    term == "centrality" ~ "Centrality",
    term == "density" ~ "Density",
    term == "network.delinquency:centrality" ~ "Delinquency*Centrality",
    T ~ NA_character_)) %>%
  mutate(model = "Model 2") %>%
  select(term, estimate, std.error, model)

gm3 <- gm3.df %>%
  mutate(estimate = exp(estimate),  # Odds ratio
         var = diag(vcov(gmodel3)),  # Variance of each coefficient
         std.error = sqrt(estimate^2 * var)) %>% #Standard Errors of the ORs
  mutate(term = case_when(
    term == "(Intercept)" ~ "Intercept",
    term == "age" ~ "Age",
    term == "female" ~ "Sex",
    term == "family.income" ~ "Family Income",
    term == "weapon.carry" ~ "Weapon Carry",
    term == "racial.heterogeneity" ~ "Racial Heterogeneity",
    term == "network.delinquency" ~ "Network Delinquency",
    term == "popularity" ~ "Popularity",
    term == "centrality" ~ "Centrality",
    term == "density" ~ "Density",
    term == "network.delinquency:popularity" ~ "Delinquency*Popularity",
    T ~ NA_character_)) %>%
  mutate(model = "Model 3") %>%
  select(term, estimate, std.error, model)

gm4 <- gm4.df %>%
  mutate(estimate = exp(estimate),  # Odds ratio
         var = diag(vcov(gmodel4)),  # Variance of each coefficient
         std.error = sqrt(estimate^2 * var)) %>% #Standard Errors of the ORs
  mutate(term = case_when(
    term == "(Intercept)" ~ "Intercept",
    term == "age" ~ "Age",
    term == "female" ~ "Sex",
    term == "family.income" ~ "Family Income",
    term == "weapon.carry" ~ "Weapon Carry",
    term == "racial.heterogeneity" ~ "Racial Heterogeneity",
    term == "network.delinquency" ~ "Network Delinquency",
    term == "popularity" ~ "Popularity",
    term == "centrality" ~ "Centrality",
    term == "density" ~ "Density",
    term == "network.delinquency:density" ~ "Delinquency*Density",
    T ~ NA_character_)) %>%
  mutate(model = "Model 4") %>%
  select(term, estimate, std.error, model)

effects.data <- rbind(gm1, gm2, gm3, gm4)


#Trying out Dwplot
(dwplot <- dwplot(effects.data, dot_args = list(size = 1.5), whisker_args = list(size = 0.3)) +
  geom_vline(xintercept = 1, colour = "grey50", linetype = 2) +
  labs(title = "Estimated Change in the Likelihood of Victimization", subtitle = "Calculated with Logistic Regression", x = "Estimated Odds Ratios", y = " ") +
  theme_bw() +
  theme(text = element_text(family = "Times"),
        plot.title = element_text(face = "bold", hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.title = element_blank()))

ggsave("dwplot.pdf",dwplot, width = 20, height = 18, units = "cm")

```

```{r Model Tables, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
set.seed(10)
#Evaluating Information Criteria
table4 <- model_weights(model, imodel1, imodel2, imodel3, weights = "waic") %>%
  as_tibble() %>% 
  rename(weight = value) %>% 
  mutate(Model  = c("Model 1", "Model 2", "Model 3", "Model 4"),
         Weight = weight %>% round(digits = 2)) %>% 
  select(Model, Weight) %>% 
  arrange(desc(Weight)) %>% 
  kable(caption = "Comparing Model Weights", "latex", booktabs = T) %>%
  kable_styling("striped")

#Odds Ratios Generated from the Models
t5 <- fixef(model) %>%
  tidy() %>%
  mutate(OR = exp(Estimate), 
         `2.5%` = exp(Q2.5), 
         `97.5%` = exp(Q97.5)) %>%
  select(OR, `2.5%`, `97.5%`)

name <- c("Intercept", "Age", "Sex", "Family Income", "Weapon Carry", "Racial Heterogeneity",  "Network Delinquency", "Popularity", "Centrality", "Density")

t5 <- t5 %>%
  round(digits = 3)

rownames(t5) <- name 

a <- fixef(imodel1) %>%
  tidy() %>%
  mutate(OR = exp(Estimate), 
         `2.5%` = exp(Q2.5), 
         `97.5%` = exp(Q97.5)) %>%
  select(OR, `2.5%`, `97.5%`)

b <- fixef(imodel2) %>%
  tidy() %>%
  mutate(OR = exp(Estimate), 
         `2.5%` = exp(Q2.5), 
         `97.5%` = exp(Q97.5)) %>%
  select(OR, `2.5%`, `97.5%`)

c <- fixef(imodel3) %>%
  tidy() %>%
  mutate(OR = exp(Estimate), 
         `2.5%` = exp(Q2.5), 
         `97.5%` = exp(Q97.5)) %>%
  select(OR, `2.5%`, `97.5%`)

t6 <- cbind(a,b,c) %>%
  round(digits = 3)

names <- c("Intercept", "Age", "Sex", "Family Income", "Weapon Carry", "Racial Heterogeneity",  "Network Delinquency", "Popularity", "Centrality", "Density", "Interaction Term")

rownames(t6) <- names

table5 <- kable(t5, caption = "Base Logistic Regression Model", "latex", booktabs = T) %>%
  add_header_above(c(" ", "Model 1" = 3)) %>%
  kable_styling("striped") %>%
  footnote(general = "N = 3145")

table6 <- kable(t6, caption = "Interaction Models", "latex", booktabs = T) %>%
  add_header_above(c(" ", "Model 2" = 3, "Model 3" = 3, "Model 4" = 3)) %>%
  kable_styling("striped") %>%
  footnote(general = "N = 3145")
```

```{r Descriptives, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
race.plot <- mydata.c %>%
  filter(race != is.na(race)) %>%
  ggplot(aes(x = race, fill = race)) +
  geom_bar() + guides(fill = F) + 
  coord_flip() +
  labs(title = "Racial Composition of Respondents", y = "Counts", x = " ") +
  scale_colour_pander() +
  scale_fill_pander() +
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5), legend.position = "none") 

mu <- mean(mydata.c$victim)
mu <- round(mu, digits = 3)

race.victim <- mydata.c %>%
  ggplot(aes(x = race)) +
  geom_bar(aes(fill = as.character(victim)), position = "fill") + guides(fill = F) + 
  geom_hline(yintercept= mu, linetype = "dashed") + #can use annotate() to label the mean line
  annotate("text", x = 8, y = 0.24, label = "Mean\nVictimization", size = 2.5) +
  coord_flip() +
  labs(title = "Victimization by Race", y = "Proportion of Victims", x = " ") +
  scale_colour_pander() +
  scale_fill_pander() +
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5), legend.position = "none") 

#Dependent Variable Breakdown Summary
Proportion <- sapply(mydata.dv, mean, na.rm = T)
cont1 <- length(which(mydata.dv$knife.gun == 1))
cont2 <- length(which(mydata.dv$shot == 1))
cont3 <- length(which(mydata.dv$stabbed == 1))
cont4 <- length(which(mydata.dv$jumped == 1))
conts <- c(cont1, cont2, cont3, cont4)

names <- c("knife.gun", "shot", "stabbed", "jumped")
Counts <- rbind(conts, names)
colnames(Counts) <- names
Counts <- Counts[-2,1:4]
Proportion <- round(Proportion, digits = 3)
t1 <- cbind(Proportion, Counts)

table1 <- kable(t1, "latex", caption = "Dependent Variable Index", booktabs = T) %>%
  kable_styling(latex_options = "striped") %>%
  footnote(general = "N = 3145")


#Creating the Summary Statistics 
mydata.num <- mydata %>%
  select(-AID, -race)

Mean <- sapply(mydata.num, mean, na.rm= T)
Stdv <- sapply(mydata.num, sd, na.rm = T)
Min <- sapply(mydata.num, min, na.rm = T)
Median <- sapply(mydata.num, median, na.rm = T)
Max <- sapply(mydata.num, max, na.rm = T)

t2 <- data.frame(
  Items = c("Question 1","Question 2","Question 3","Question 4","Question 5","Question 6","Question 7"),
  Features = c("During the past twelve months, how often did you smoke cigarettes?", "During the past twelve months, how often did you drink beer, wine, liqour?", "During the past twelve months, how often did you get drunk?", "During the past twelve months, how often did you race on a bike, skateboard, roller blades, or in a boat or car?", "During the past twelve months, how often did you do something dangerous because you were dared to?", "During the past twelve months, how often did you lie to your parents or guardians?", "During the past twelve months, how often did you skip school without an excuse?"))

table2 <- kable(t2, caption = "Friendship Network Delinquency Index" , "latex", booktabs = T) %>% 
  kable_styling(full_width = F) %>% 
  column_spec(1, bold = T) %>% 
  column_spec(2, width = "30em")

t3 <- round(cbind(Mean, Stdv, Min, Median, Max), digits=3)

table3 <- kable(t3, caption = "Descriptive Statistics","latex", booktabs = T) %>%
  kable_styling(latex_options = "striped") %>%
  footnote(general = "N = 3145")
```

```{r Figure 1, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#New data frame with variables held constant - Interactions held at quantiles or scaled
age <- mean(mydata.c$age)
female <- mean(mydata.c$female)
family.income <- mean(mydata.c$family.income)
weapon.carry <- mean(mydata.c$weapon.carry)
racial.heterogeneity <- mean(mydata.c$racial.heterogeneity)
network.delinquency <- seq(0, 5, by = .1)
popularity <- mean(mydata.c$popularity)
centrality <- quantile(mydata.c$centrality, c(.1, .5, .9))
density <- mean(mydata.c$density)


predictions <- as.tibble(expand.grid(age, female, family.income, weapon.carry, racial.heterogeneity, network.delinquency, popularity, centrality, density))   
colnames(predictions) <- c("age", "female", "family.income", "weapon.carry", "racial.heterogeneity", "network.delinquency", "popularity", "centrality", "density")      

e <- fixef(imodel1)

#Predicted Likelihood of Victimization added to the newdata 
samples <- predictions %>%             
  mutate(victim = inv_logit_scaled(e[1,1] + e[2,1]*age + e[3,1]*female + e[4,1]*family.income + e[5,1]*weapon.carry + e[6,1]*racial.heterogeneity + e[7,1]*network.delinquency + e[8,1]*popularity + e[9,1]*centrality + e[10,1]*density + e[11,1]*network.delinquency*centrality)) %>%         
  group_by(network.delinquency, centrality) %>%                              
  slice(1)

#Visualize: Centrality Interactions
samples$centrality <- as.character(samples$centrality)
samples <- samples %>%
  mutate(Centrality = case_when(
    centrality == "0" ~ "10th Percentile",
    centrality == "0.78677539864745" ~ "50th Percentile",
    centrality == "1.70187217534238"  ~ "90th Percentile",
    T ~ NA_character_))

plot1 <- ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
  geom_line(aes(y = victim, color = Centrality), size = 1.5) +
  labs(title = "The Conditional Effects of Network Content and Form on Victimization", subtitle = "Interacting Network Delinquency & Centrality", x = "Average Delinquency in Friendship Network", y = "Probability of Victimization", caption = "Figure 2") +
  scale_colour_pander() +
  scale_fill_pander() +
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5, size = 12), plot.subtitle = element_text(hjust = 0.5)) +
  ggsave("plot1.pdf", width = 20, height = 15, units = "cm")
```

```{r Figure 2, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#New data frame with variables held constant - Interaction terms held at quantiles
age <- mean(mydata.c$age)
female <- mean(mydata.c$female)
family.income <- mean(mydata.c$family.income)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
racial.heterogeneity <- mean(mydata.c$racial.heterogeneity)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
popularity <- quantile(mydata.c$popularity, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)

predictions <- as.tibble(expand.grid(age, female, family.income, weapon.carry, racial.heterogeneity, network.delinquency, popularity, centrality, density))   
colnames(predictions) <- c("age", "female", "family.income", "weapon.carry", "racial.heterogeneity", "network.delinquency", "popularity", "centrality", "density")      

e <- fixef(imodel2)

#Predicted Likelihood of Victimization added to the newdata 
samples <- predictions %>%             
  mutate(victim = inv_logit_scaled(e[1,1] + e[2,1]*age + e[3,1]*female + e[4,1]*family.income + e[5,1]*weapon.carry + e[6,1]*racial.heterogeneity + e[7,1]*network.delinquency + e[8,1]*popularity + e[9,1]*centrality + e[10,1]*density + e[11,1]*network.delinquency*popularity)) %>%         
  group_by(network.delinquency, popularity) %>%                              
  slice(1)

#Visualize: Centrality Interactions
samples <- samples %>%
  mutate(Popularity = case_when(
    popularity == 1 ~ "10th Percentile",
    popularity == 4 ~ "50th Percentile",
    popularity == 10  ~ "90th Percentile",
    T ~ NA_character_))

samples$Popularity <- as.factor(samples$Popularity)

plot2 <- ggplot(samples, aes(x = network.delinquency , group = Popularity)) +
  geom_line(aes(y = victim, color = Popularity) , size = 1.5) +
  labs(title = "The Conditional Effects of Network Content and Form on Victimization", subtitle = "Interacting Network Delinquency & Popularity", x = "Average Delinquency in Friendship Network", y = "Probability of Victimization", caption = "Figure 3") +
  scale_colour_pander() +
  scale_fill_pander() +
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5, size = 12), plot.subtitle = element_text(hjust = 0.5)) +
  ggsave("plot2.pdf", width = 20, height = 15, units = "cm")
```

```{r Figure 3, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#New data frame with variables held constant - Interaction terms held at quantiles
age <- mean(mydata.c$age)
female <- mean(mydata.c$female)
family.income <- mean(mydata.c$family.income)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
racial.heterogeneity <- mean(mydata.c$racial.heterogeneity)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
density <- quantile(mydata.c$density, c(.1, .5, .9))
popularity <- mean(mydata.c$popularity, na.rm = T)

predictions <- as.tibble(expand.grid(age, female, family.income, weapon.carry, racial.heterogeneity, network.delinquency, popularity, centrality, density))   
colnames(predictions) <- c("age", "female", "family.income", "weapon.carry","racial.heterogeneity", "network.delinquency", "popularity", "centrality", "density")   

e <- fixef(imodel3)

#Predicted Likelihood of Victimization added to the newdata 
samples <- predictions %>%             
  mutate(victim = inv_logit_scaled(e[1,1] + e[2,1]*age + e[3,1]*female + e[4,1]*family.income + e[5,1]*weapon.carry + e[6,1]*racial.heterogeneity + e[7,1]*network.delinquency + e[8,1]*popularity + e[9,1]*centrality + e[10,1]*density + e[11,1]*network.delinquency*density)) %>%         
  group_by(network.delinquency, density) %>%                              
  slice(1)


#Visualize: Centrality Interactions
samples$density <- as.character(samples$density)

samples <- samples %>%
  mutate(Density = case_when(
    density == "15.71428571429" ~ "10th Percentile",
    density == "26.19047619048" ~ "50th Percentile",
    density == "50"  ~ "90th Percentile",
    T ~ NA_character_))

plot3 <- ggplot(samples, aes(x = network.delinquency , group = Density)) +
  geom_line(aes(y = victim, color = Density) , size = 1.5) +
  labs(title = "The Conditional Effects of Network Content and Form on Victimization", subtitle = "Interacting Network Delinquency & Density", x = "Average Delinquency in Friendship Network", y = "Probability of Victimization", caption = "Figure 4") +
  scale_colour_pander() +
  scale_fill_pander() +
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5, size = 12),  plot.subtitle = element_text(hjust = 0.5)) +
  ggsave("plot3.pdf", width = 20, height = 15, units = "cm")
```

```{r RH Figures, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
racial.heterogeneity <- quantile(mydata.c$racial.heterogeneity, c(.25, .75))
  
mydata.c <- mydata.c %>%
  mutate(rh.cat = case_when(
    racial.heterogeneity <= .25 ~ "25th Percentile", 
    (racial.heterogeneity > .25 & racial.heterogeneity < .6) ~ "IQR",
    racial.heterogeneity >= .6 ~ "75th Percentile",
    T ~ NA_character_))

racial.heterogeneity.levels <- c("25th Percentile", "IQR", "75th Percentile")

mydata.c <- mydata.c %>%
  mutate(rh.cat = factor(rh.cat, levels = racial.heterogeneity.levels, ordered = T))
  
(rh.victim <- mydata.c %>%
  ggplot(aes(x = rh.cat)) +
  geom_bar(aes(fill = as.character(victim)), position = "fill") +
  geom_hline(yintercept= mean(mydata.c$victim), linetype = "dashed") +
  ylim(0, .22) + 
  annotate("text", x = 1, y = 0.2, label = "Mean\nVictimization", size = 3) +
  coord_flip() +
  labs(title = "Racial Heterogeneity & Victimization", y = "Proportion of Victims", x = " ") +
  scale_fill_manual(values=c("white", "seagreen"), 
                       name="Victimization",
                       breaks=c("1", "0"),
                       labels=c("Victims", "Non-Victims")) + 
  theme_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5)))
ggsave("rh.victim.pdf", rh.victim, width = 25, height = 15, units = "cm")


network.delinquency <- quantile(mydata.c$network.delinquency, c(.25, .75))

mydata.c <- mydata.c %>%
  mutate(Delinquency = case_when(
    network.delinquency <= .7143 ~ "Non Delinquents", #At or Below the 25th Percentile
    (network.delinquency > .7143 & network.delinquency < 1.4286) ~ "Average Teen", #IQR 
    network.delinquency >= 1.4286 ~ "Delinquents", #At or Above the 75th Percentile
    T ~ NA_character_))

(rh.delinquency <- mydata.c %>%
  ggplot(aes(x = rh.cat)) +
  geom_bar(aes(fill = Delinquency), position = "fill") + 
  coord_flip() +
  labs(title = "Racial Heterogeneity & Delinquency", y = "Proportion of Delinquents", x = " ") +
  theme_pander() + 
  scale_fill_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5)))
ggsave("rh.delinquency.pdf", rh.delinquency, width = 25, height = 15, units = "cm")

a <- grid.arrange(rh.victim, rh.delinquency, nrow = 2)
ggsave("rh.pdf", a, width = 25, height = 15, units = "cm")


(race.delinquency <- mydata.c %>%
  ggplot(aes(x = race)) +
  geom_bar(aes(fill = Delinquency), position = "fill") + 
  coord_flip() +
  labs(title = "Racial & Delinquency", y = "Proportion of Delinquents", x = " ") +
  scale_fill_pander() + 
  theme(text = element_text(family = "Times"), plot.title = element_text(hjust = 0.5)))
ggsave("race.delinquency.pdf", race.delinquency, width = 25, height = 15, units = "cm")

```


##Introduction
The formative years in the lives of many American teenagers take place within the context of public or private school systems. In these contexts, teens are consistently exposed to many opportunities to practice forming and maintaining social relationships. One potential outcome of adolescent social relations is the risk of engaging with delinquency and violence, especially when teens are unsupervised (Haynie & Osgood 2005). In fact, in the United States youth are more than 2.3 times more likely than the general population to be victims (Hanish and Guerra 2000). Sociological research on adolescent crime and delinquency suggests that the social characteristics of an adolescent’s community heavily influence the likelihood of that teen’s involvement in delinquent behavior and perhaps the likelihood of their victimization (Hanish and Guerra 2000; Schreck, Fisher, and Miller 2004; Mouttapa, Valente, Gallaher, Rohrbach and Unger 2004; Sampson 1984; Moody 2001; Berg, Brunson, and Stewart 2012; Sampson and Groves 1989; Pridemore 2002; Evans and Smokoski 2016; Shaw and Mckay ([1942] 1969); Hirschi 1969; Sutherland and Cressey 1974). Schreck et al. (2004) speculate that research on victimization could benefit from studies emphasizing the peer influences generated by delinquent groups, because delinquency and victimization share many empirical connections. Their study identified peer delinquency as a significant risk factor for violent victimization. Additionally, Hirschi’s (1969) theory of social control and Sutherland’s (1974) theory of differential association have both empirically verified a connection between social networks and delinquency/crime and have been adapted and replicated by modern sociologists such as Haynie (2001), Matsueda (1982), and Mangino (2009). Just as there is a relationship between network position and delinquency, it follows, that there is a likely connection between the social network occupied by an adolescent and their chances of becoming a victim. However, the likelihood of victimization compared to the propensity towards delinquency may function differently in terms of causal mechanisms, particularly the mediating effects of the network’s structure. I posit that adolescent friendship networks influence how individuals learn behaviors and that the specific behaviors they adopt will either enhance or limit their exposure to violence. For this analysis I test the relationship between instances of serious nonfatal forms of victimization and the behavioral norms of adolescent friendship networks. Interaction terms are included to examine whether the influence of these norms on victimization are conditioned by the structural position of adolescents within their friendship networks. I hypothesize that network structure will have substantive influence on the relationship between network delinquency and violent victimization. 

##Data

*The National Longitudinal Student of Adolescent to Adult Health*

To test the influence of friendship network content and structure on teen's exposure to violent victimization, this study employs the public use  data from the first wave of The National Longitudinal Study of Adolescent to Adult Health (Here after Add Health). The data consists of a nationally representative sample of teens, grades 7 – 12, nested in randomly selected public and private schools throughout the United States in 1994-95. Information on the sample was collected from the respondents, their peers, school administrators, parents, siblings, and romantic partners through an initial in-school survey followed by four in-home interviews. 

*In-School Surveys*

Add Health’s In-School Questionnaire, a self-administered instrument, was distributed to more than 90,000 students in grades 7 through 12 in an hour-long class period between fall 1994 and spring 1995. The questionnaire consisted of many topics, from education and parental occupation to self-esteem and risk behaviors, but most important to this study was the information collected on student’s behaviors and friendships. Respondents were asked to name their five closest female friends and their five closest male friends. In instances where the friendship nominations were members of the same school as the respondent, as more than 80 percent of nominations were, data was also available on the nominees. The Add Health study design makes it possible to reconstruct the social networks of most students. This network information enables researchers to calculate behavioral attributes present in each respondent’s own friendship network, such as delinquency, as well as test the structural influences the network may have on behavior or propensity to victimization. 

*In-Home Interviews*

Data from the more in-depth in-home interviews contains sensitive information on the adolescents such as experience with drugs and alcohol and various other risky behaviors such as carrying a weapon. One of the most advantageous components of this in-home method was the use of laptop computers which played prerecorded questions about experiences with victimization. This method of data collection helped to maintain confidentiality on numerous sensitive subjects. These self-reported experiences from the first wave of in-home interviews was used to construct the dependent variable – victim – for this study. The public use data includes a representative sample of 6504 respondents from the original 90,000 students. The final research sample for the project consists of 3145 respondents with complete data from both the in-school and in-home interviews. 

##Variable Construction

*The Dependent Variable: Violent Victimization*

The variable victim is a composite indicator of victimization experienced in the twelve months prior to the wave 1 in-home interviews. Table 1 from the Appendix shows the items used to construct the variable victim. The variable takes on the value of 0, if the respondent experienced none of the forms of physical victimization listed in Table 1, or 1 if they have experienced one of the forms  at least once in the past year. The variable was designed to measure purely physical manifestations of victimization i.e. being shot, stabbed, jumped, or having a knife or gun pulled on you. Table 3 in the Appendix displays descriptive statistics for the sample and shows that the victimization variable has a mean of 0.201 and a standard deviation of .401. About 20% of the sample has experienced one of the forms of violence from Table 1. 

*Network Delinquency*

The key contextual network variable deals with delinquency within the respondent’s peer group. The variable network delinquency is a measure of minor delinquent acts committed by the respondent’s ten closest friends in the year prior to taking the in-school surveys. It takes the information given by friends named in the respondents in-school survey and averages their scores to create a delinquency measure. The delinqeuncy information provided for each friend named comes from the qustions in Table 2 in the Appendix which ranged from 0, indicating never having committed the act, to 5, committing the act up to 5 days of the week. The index ranges from 0 to 4.714 with an average score of 1.139 and a standard deviation of 0.587 as seen in Table 3.

*Popularity & Centrality*

Being a highly visible member, that is standing out, in a delinquent network is likely to increase one’s chances of being seen as a suitable target for victimization. Two variables have been chosen to operationalize this concept. Popularity is a measure of the number of friendship nominations received by the respondent. The nominations range from 0 to 30 with a mean of 4.551 and a standard deviation of 3.692. When a person receives more friendship nominations it is a stark example of high visibility with in an adolescent’s school. The second operationalization of standing out is centrality. Centrality is a measure of the number of links required to link all other peers in the adolescent’s friendship network. Centrally situated adolescents stand out because they are a focal node, much of the information flowing through the network flows through members with high centrality scores. The centrality variable is calculated in the Add Health data using Bonacich’s formula (Bonacich 1987). Centrality for the research sample ranges from 0 to 4.288 has a mean of 0.792 and a standard deviation of 0.631. 

*Density*

I use the variable density as a contrast to stanging out in a network. A highly dense network is marked by uniformity and a lack of individuality (Bearman, 1991). When there is less individuality, each member stands out less and should blend into the network as an unstuiable target. The variable is defined as the number of ties in the adolescent’s friendship network divided by the total number of possible ties, and is represented in the research sample as a percentage and ranging from 0 to 100. Table 3 shows that the mean density for the sample is 29% with a standard deviation of 15.2%. 

*Weapon Carrying* 

I included the variable weapon carry as a control for individual inclinations towards violence so we can better isolate the potential effects of network content and form on victimization. The variable weapon carry is a binary indicator for carrying a knife, club, or gun on school grounds in the thirty days prior to the wave 1 in-home interviews. It takes on the value of 0, if the respondent has not carried any of these weapons or 1 if they have. The weapon carry variable has a mean of 0.058 and a standard deviation of 0.235 for the research sample. Nearly 6% of the sample had carried a weapon to school in the month prior to the in home surveys. 

*Racial Heterogeneity*

I use the network racial heterogeneity to control for potential counfounding dealing with adolescents' normative climate. Racial Heterogeneity has been linked to a lack of normative consensus but for this project I am interested in shifting attitudes about the appropriateness of delinquency in particular. The variable racial heterogeneity is a measure of the racial diversity of the respondent's friendship network with respect to the number of racial identities present in the respondent's school. A score of 0 would indicate that the the network is completely homogeneous and a score of 1 would indicate that each racial identity recorded at the school level is also present in the respondent's own network. The variable from the sample has mean of 0.444 and a standard deviation of 0.195. 

*Basic Controls* 

Hindelang, Gottfredson, and Garofalo (1978) suggest that demographic characteristics (age, gender, income, etc.) are associated with various role expectations, which, in turn, lead to difference in lifestyles, exposure to risk, and subsequently to difference in the likelihood of victimization. The respondent's age, biological sex, and family's annual income in thousands of dollars at the time of the interview are the basic control variables used in the analysis. Literature on victimization claims that younger teens and males have higher risk for victimization. Family income, measured as parent's reported annual income in thousands of dollars, is included in the models to serve as a weak control for the potential influences of socioeconomic status on exposure to violence. Descriptives for these variables are shown in Table 3 in the Appendix. 

*Race* 

Research suggests that race is a robust determinant of victimization. Van Dorn (2004) states that there are a substantial number of high school students who reported seeing or hearing about racially or religiously motivated confrontations. In fact, 75% of all high school students from their study reported seeing these incidences on a regular basis. The Add Health study asks each respondent to choose their race from a provided list. The categories are presented in figure 1 below. Opting for a more descriptive analyses of the relationship between a respondent's self identified race allows researchers to make better substantive claims about how race effects outcomes of interest (Bonilla-Silva & Zuberi 2008). In lieu of using respondent's race in the inferential model I use the proportion of racial identities present in the respondent's friendship network based on the total racial identities present in their school. In order to not comppletely omit the role of racial identity in victimization a descriptive plot details the relationship. 

##Analytic Strategy
The dependent variable for this paper is dichotomous and therefore, the normal assumptions of ordinary least squared regression cannot be maintained. To compensate, logistic regression analysis, designed to handle dependent variables of this nature, is used to analyze the data. The logistic regression analysis for this project interprets the odds ratios for the independent variables that represent the individual variable’s influence on the likelihood of victimization net of the other included indicators. The statistical method used in this paper anticipates victimization as the data used to construct the primary independent variables were collected in the first in-school survey while the data used to construct the variable victimization come from the in-home interviews conducted approximately a year after the first wave of in-school surveys were administered. This study design allows me to directly test the interactions between network structure as measured by popularity, centrality, and density and network context as measured by friendship delinquency and the resulting association with victimization. The functional form of the included interaction models is as follows: 

$$Victim \sim Binomial(1,p_i)$$
$$logit(p_i) = \alpha + \textbf{X}_i \pmb\beta_i$$
$$\alpha \sim Normal(0, 10)$$
$$\pmb\beta_i \sim Normal (0, 10)$$
where $\textbf{X}_i$ represents a vector of the predictor variables included in Table 3 and $\pmb\beta_i$ is the vector of associated estimates used to calculate the odds ratios for each individual variable. Each varaible is assumed to have a linear relationship to victimization as there were no variable transformations that improved the model or changed the predicted probability of victimizartion. Because there is little research informing victimization in a bayesion context I use very gently regularizing prior information to assist in constructing these estimates. Denoted in lines three and four of the mathematical formula above both the intercept and the vector of beta coefficients are assumed to follow a normal distribution with a mean of 0 and a standard deviation of 10. These parameters where chosen as priors in this analysis for their lack of informativeness. Prior information in a bayesian context should guide our models towards more accurate posterior distributions and there for better predictions however the estimates generated by a bayesian model will be overwhelmed by even moderate evidence of an association between the included predictors and the dependent variable.

*Model Creation & Selection*

In order to directly test my research question I run four logistic regression models. Model 1 is the base model and simply includes each untransformed variable into the linear equation to predict victimization. The next three models include an interaction term between the teen's network structure and content. Network structure is measured by centrality, popularity, and density in each respective model. Content is constant and measured by network delinquency in each model. To summarize, Model 2 includes the interaction using centrality, Model 3 uses popularity, and Model 4 uses density. In each of these models the network structural variable is multiplied by network delinquency. These models where created using the R package BRMS and use markov chain monte carlo simulations (MCMC here after) to achieve logistic regression. 

Akaike weights were used to select between the models. The weight formula places widely applicable information criteria on a probability scale by undoing the multiplication of the deviance by negative two and then exponentiating that value to reverse the log transformation. Next it standardizes these values by deviding by the calculated total. Each weight will now be a number from zero to one where the sum total of each weight will always equal one. A model’s weight is an estimate of the probability that the model will make the best predictions on new data, conditional on the set of models considered (McElreath). Akaike wieghts are inconsistant when comparing MCMC models due to the sampling error characteristic of simulations. However, despite the variability in akaike weight cacluated to compare my MCMC models I was able to gain some consistancy in the model selection by setting a seed for the simulations. The weights can be seen in Table 4. Model 2 is consistantly choosen as having the most probabilistic predictions with Model 3 always in close second. Model 4 takes up any of the remaining weight leaving a consistant weight of zero for the base Model 1. Because each interaction model absorbed some of the weight I decided to plot each and discuss their implications in answering my research question.

##Results
 
```{r Race Figure, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
a <- grid.arrange(race.plot, race.victim, nrow = 2, bottom = textGrob("Figure 1", x = .9, y = .5, gp = gpar(fontsize = 8)))

ggsave("race_plot.pdf", a, width = 25, height = 15, units = "cm")
```

Studies of violent victimization among youth have consistently shown that individuals of color, particularly African Americans, are at elevated risk (Hanish and Guerra 2000; Haggerty et al. 2013). Figure 1 shows the racial composition of the complete sample as well as rates of victimization by race. My results show that victimization disproportionally affects people of color particularly native americans. Asian and White adolescents are the only racial categories victimizaed at a lower rate than the sample mean, denoted by the dashed red line. 

Tables 5 and 6 in the Appendix show the odds ratios and their associated 95% Highest Posterior Density Intervals (here after HPDI) calculated from the logistic regression models described in the section above. The HPDI defines the interval that best represents the paramter values most consistant with the data (McElreath). Model 1 from table 5 shows the odds ratios calculated the basic logistic regression including all selected variables but does not include any interactions. Model 1 estimates that as students age one year their chance of victimization increases by about 1.9%, net of the other variables. Though the literature claims that younger children and males are at greater risk of victimization, victimization as I have defined it only includes serious nonfatal forms of physical violence. As Model 1 shows, younger children are actually safer than their older counterparts in terms of physical violence. Also, while considering the included variables, female respondents are 58.8% less likely than males to be victims of violence, which follows the literature. Net of the included variables, every thousand dollar increase in the respondent’s family annual income results in a 0.9% decrease in the likelihood of victimization. Carrying a weapon in the last month is strongly related to victimization according to Model 1. The model estimates that teens who carried a weapon in the last month are 375.6% more likely to be victims of physical violence. This result supports literature that discusses the ways victims of violence protect themselves from future threats. Racial heterogeneity is also associated with the risk of victimization. As the proportion of racial identities present in the friendship network goes from 0 (completely homogeneous) to 1(completely heterogeneous) the likelihood of victimization increases by 87.9%. While this result doesnt capture the subtleties involved with increasing diversity it lends support to the idea that racial heterogeneity increases the salience of race as an organizing principle and diminishes the cohesive normative structures associated with protecting teens from violence in school. 

For the key context variable, network delinquency, a one unit increase in friends’ delinquency results in a 37.5% increase in the likelihood of ego’s victimization. Additionally, the more popular a person is in their network the less likely they are to experience violent victimization. As popularity increases by one nomination the likelihood of victimization decreases by 1.6%, while controlling for the other independent variables. Similar to popularity, centrality has a negative relationship with victimization, albeit a stronger one. As centrality increases by a single unit the likelihood of victimization decreases by 28.5%, net of the included variables. Finally, as the density of the friendship network increases by 1% the likelihood of victimization decreases by 0.6%. Model 1 however doesnt test for how the relationship between network structure and victimization may be conditioned by the network's content. Models 2, 3, and 4 test wether there is some conditional effect between network structure and network delinquency. The models presented in Table 6 in the Appendix examine the relationship between the respondent’s friendship network delinquency and their victimization and whether it is conditioned by their structural position within the network. To test this effect, the Models include the cross-product of network structural variables and average network delinquency. In order to interpret the interaction effect of structure and delinquency on victimization I broke up the structural variables in to three categories, low, middle, and high defined by their 10th, 50th, and 90th percentile values respectively. Next, I plotted the predicted probability of victimizartion across the range of network delinquency scores while holding all other included variables at their means, as shown in Figures 2, 3, and 4. Predicted probabilities were calulated with the inverse link function to convert the original estimates from log odds to probabilities. The interaction effects become plain to see in the figures below. 

\newpage
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot1
```


When analyzing respondents who are embedded in highly delinquent networks, the evidence for the adverse effects of “standing out” become apparent. Model 2 shows that given a delinquent network, individuals with high centrality are more likely to become a victim than their low centrality counter parts. That is, standing out in a delinquent network increases one’s risk of violent victimization. Figure 1 shows that those adolescents who have high centrality within a highly delinquent network have over an 80% chance of victimization, while those who occupy less prominent positions within equally delinquent networks have much lower likelihoods of victimization. In networks with low delinquency the effects reverse. For respondents whose friendship networks have lower levels of delinquency and who occupy a more central position, the ego’s risk of victimization decreases. When the ratio of definitions in an adolescent's friendship network is unfavorable to committing delinquent acts, then the normative social practices of the peer group pull the adolescent further away from situations in which engaging in violence is possible. Figure 2 illustrates this phenomena, as adolescents with high centrality and who occupy non-delinquent networks have less than a 10% chance of becoming victims of violence. To summarize, high centrality “amplifies” the effect of the network’s delinquent content on the teens risk of violent victimization. In other words, one does not want to be a central member in a highly delinquent network. 


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot2
```

Model 3 examines how popularity conditions the effects of network delinquency on victimization. Nearly identical to the pattern obersved in Figure 2 popularity amplifies the effect of network delinquency on victimization. Increasing popularity while in highly delinquent networks increases victimization. Adolescents who received a greater number of friendship nominations and exist in a highly delinquent network are predicted to have over an 80% chance of victimization. Conversely, those adolescents who received more friendship nominations and who occupied a network with lower levels of delinquency saw the effect reverse; they reported the lowest levels of victimization in the figure at about a 5% chance. Figures 2 and 3 show that centrality and popularity exhibit similar effects on victimization when interacting with network delinquency. Given these predictions from the logistic regression models I believe that both popularity and centrality are useful operationalizations for measuring structurally salient positions within friendship networks. 

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot3
```

Model 4 explores the interaction effects of the respondent's network density score and the average delinquency of the respondent’s closest friends on violent victimization. The results are plotted in Figure 4. In a high delinquency network, increasing density reduces the likelihood of victimization. Adolescents who occupy a highly delinquent network and have higher density scores are predicted to have less than a 20% chance of being victimized while members of the same delinquent network with lower density have a above a 60% chance. The 90th percentile for density was 0.5 indicating that having half of all possible reciprocal ties in a delinquent network is enough to form a protective shell around an adolescent. Taking the interaction in Figure 4 to its conclusion, in a low delinquency network blending in has less of an effect on an adolescent’s propensity to be victimized. Higher density in social networks where the ratio for definitions favor non-delinquent behavior has little effect on the ego’s changes of becoming a victim meaning that density does not function to amplify the effects of the network’s delinquent content as centrality and popularity do. Instead, the variable density functions to conceal members within cohesive delinquent groups and protect them from violence. 

##Discusion and Conclusion

The Models presented in the analysis provide support for the hypotheses that network structure conditions the influence of network content on violent victimization. These concepts were operationalized using the common network structural variables centrality, popularity, and density while the content of the network was measured by the average delinquency of a teenager’s friends. Occupying delinquent networks in which the actual number of social ties is close to the number of possible ties creates a protective shell around adolescents as shown in Figure 4. On the other hand, standing out in delinquently oriented groups increases one’s own risk of victimization as seen in Figures 2 and 3. In addition to supporting the actual hypotheses, the study shows the importance of making a distinction between a network’s content and its form, and that attention should be paid to how content and form interact with one another. These findings however, necessitate some additional clarification in terms of the reality of what the data is showing. The findings in this study suggest that standing out in a delinquent network will increase the likelihood of an adolescent being exposed to violent situations however, given the data, there is no way to differentiate between perpetrators initating the first instance of violence and retaliating victims given the data. So I can't be certain about the relationship between prior victimization and future exposure to violence. This limitation is most apparent in interpreting the effects of carring a weapon to school. Is it for protection? status? retaliation? All we know for sure is that weapon carrying and instances of violence tend to happen together. That being said I believe I have shown that the structural position defined by the variable density is conceptually different than the positions of central or popular adolescents within highly delinquent networks when predicting adolescent inclinations towards exposure to violence. 

\newpage

```{r Appendix, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
table1
table2
table3
table4
table5
table6
```

