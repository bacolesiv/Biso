weights <- da21600.0004
#Merging Relevant Variables into one Data Frame
data1 <- wave1.data %>%
dplyr :: select(AID, H1FV2, H1FV3, H1FV4, H1FV6, S6A, S6B, S6C, S6D, S6E, S4, S1, S2, PA55, H1FV9)
data2 <-  network.data %>%
dplyr :: select(AID, ESRDEN, BCENT10X, IDGX2, SEG1RCE5, ERNRC5, EHRC5, AXS59A, AXS59B, AXS59C, AXS59D, AXS59E, AXS59F, AXS59G, SRCE51, SRCE52, SRCE53, SRCE54, SRCE55)
data3 <- weights %>%
dplyr :: select(AID, GSWGT1)
mydata <- merge(data1, data2, by = "AID")
#mydata <- merge(my.data, data3, by = "AID")
summary(wave1.data$S4)
#Race variable
mydata <- mydata %>%
mutate(race = case_when(
(S4 == "(1) (1) Yes (go to Q.5)" & S6A == "(1) (1) Marked") ~ "white latino",
(S4 == "(1) (1) Yes (go to Q.5)" & S6B == "(1) (1) Marked") ~ "black latino",
(S6A == "(1) (1) Marked" & S6B== "(1) (1) Marked") ~ "mixed race",
(S6A == "(1) (1) Marked" & S6C == "(1) (1) Marked") ~ "mixed race",
(S6A == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
(S6A == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
(S6B == "(1) (1) Marked" & S6C == "(1) (1) Marked") ~ "mixed race",
(S6B == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
(S6B == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
(S6C == "(1) (1) Marked" & S6D == "(1) (1) Marked") ~ "mixed race",
(S6C == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
(S6D == "(1) (1) Marked" & S6E == "(1) (1) Marked") ~ "mixed race",
S4 == "(1) (1) Yes (go to Q.5)" ~ "latino",
S6A == "(1) (1) Marked" ~ "white",
S6B == "(1) (1) Marked" ~ "black",
S6C == "(1) (1) Marked" ~ "asian",
S6D == "(1) (1) Marked" ~ "native american",
S6E == "(1) (1) Marked" ~ "other",
T ~ NA_character_))
#Victimization
mydata <- mydata %>%
mutate(victim = case_when(
(H1FV2 == "(1) (1) Once" |  H1FV2 == "(2) (2) More than once") ~ 1,
(H1FV3 == "(1) (1) Once" |  H1FV3 == "(2) (2) More than once") ~ 1,
(H1FV4 == "(1) (1) Once" |  H1FV4 == "(2) (2) More than once") ~ 1,
(H1FV6 == "(1) (1) Once" |  H1FV6 == "(2) (2) More than once") ~ 1,
H1FV2 == "(0) (0) Never" ~ 0,
H1FV3 == "(0) (0) Never" ~ 0,
H1FV4 == "(0) (0) Never" ~ 0,
H1FV6 == "(0) (0) Never" ~ 0,
T ~ NA_real_))
#Creating the Network Delinquency Variable
mydata <- mydata %>%
mutate(network.delinquency = (AXS59A + AXS59B + AXS59C + AXS59D + AXS59E + AXS59F + AXS59G)/7)
#Cleaning Control Variables
mydata <- mydata %>%
mutate(sex = case_when(
S2 == "(1) (1) Male" ~ "male",
S2 == "(2) (2) Female" ~ "female",
T ~ NA_character_))
mydata$age <- mydata$S1
mydata$family.income <- mydata$PA55
mydata <- mydata %>%
mutate(weapon.carry = case_when(
H1FV9 == "(0) (0) None (skip to Q.11)" ~ 0,
(H1FV9 == "(1) (1) 1 day" | H1FV9 == "(2) (2) 2 or 3 days" | H1FV9 == "(3) (3) 4 or 5 days" | H1FV9 == "(4) (4) 6 or more days") ~ 1,
T ~ NA_real_))
#Renaming Network Variables
mydata$racial.heterogeneity <- mydata$ERNRC5
mydata$density <- mydata$ESRDEN
mydata$centrality <- mydata$BCENT10X
mydata$popularity <- mydata$IDGX2
#Variable Selection
mydata <- mydata %>%
select(AID, victim, race, sex, age, family.income, weapon.carry, network.delinquency, popularity, centrality, density)
#Making Categorical Variables Recognizable to the regression model
mydata$sex <- as.factor(mydata$sex)
#Making model
#imodel <- glm(victim ~ + weapon.carry + network.delinquency + popularity + centrality + density + network.delinquency*centrality, data = mydata.c, family = "binomial")
imodel <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
mydata.c <- mydata[complete.cases(mydata), ]
#Making model
#imodel <- glm(victim ~ + weapon.carry + network.delinquency + popularity + centrality + density + network.delinquency*centrality, data = mydata.c, family = "binomial")
imodel <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
#New data frame with variables held constant - Interaction terms held at quantiles
#age <-  mean(mydata.c$age, na.rm = T)
#sex <- c("male", "female")
#family.income <- mean(mydata.c$family.income, na.rm = T)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
popularity <- mean(mydata$popularity, na.rm = T)
centrality <- quantile(mydata$centrality, c(.1, .5, .9), na.rm = T)
density <- mean(mydata$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel@coef, Sigma = imodel@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
#Visualize
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.7247246 ~ "50th Percentile",
centrality == 1.6367891  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
summary(samples$centrality)
class(samples$centrality)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.725~ "50th Percentile",
centrality == 1.637  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.725~ "50th Percentile",
centrality == 1.637  ~ "90th Percentile",
T ~ NA_character_))
#Making model
#imodel <- glm(victim ~ + weapon.carry + network.delinquency + popularity + centrality + density + network.delinquency*centrality, data = mydata.c, family = "binomial")
imodel <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
#New data frame with variables held constant - Interaction terms held at quantiles
#age <-  mean(mydata.c$age, na.rm = T)
#sex <- c("male", "female")
#family.income <- mean(mydata.c$family.income, na.rm = T)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
popularity <- mean(mydata.c$popularity, na.rm = T)
centrality <- quantile(mydata.c$centrality, c(.1, .5, .9), na.rm = T)
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel@coef, Sigma = imodel@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
#Visualize
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.725~ "50th Percentile",
centrality == 1.637  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
class(samples$centrality)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.787~ "50th Percentile",
centrality == 1.702  ~ "90th Percentile",
T ~ NA_character_))
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.7867628~ "50th Percentile",
centrality == 1.702  ~ "90th Percentile",
T ~ NA_character_))
View(samples)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.7867628 ~ "50th Percentile",
centrality == 1.7016744  ~ "90th Percentile",
T ~ NA_character_))
#Making model
#imodel <- glm(victim ~ + weapon.carry + network.delinquency + popularity + centrality + density + network.delinquency*centrality, data = mydata.c, family = "binomial")
imodel <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
#New data frame with variables held constant - Interaction terms held at quantiles
#age <-  mean(mydata.c$age, na.rm = T)
#sex <- c("male", "female")
#family.income <- mean(mydata.c$family.income, na.rm = T)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
popularity <- mean(mydata.c$popularity, na.rm = T)
centrality <- quantile(mydata.c$centrality, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel@coef, Sigma = imodel@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
#Visualize
samples <- samples %>%
mutate(Centrality = case_when(
centrality == 0 ~ "10th Percentile",
centrality == 0.7867628 ~ "50th Percentile",
centrality == 1.7016744  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
class(samples$centrality)
View(samples)
samples$centrality <- as.character(samples$centrality)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == "0" ~ "10th Percentile",
centrality == "0.7867628" ~ "50th Percentile",
centrality == "1.7016744"  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
samples$centrality <- as.character(samples$centrality)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == "0" ~ "10th Percentile",
centrality == "0.7867627910904" ~ "50th Percentile",
centrality == "1.70167438806094"  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
imodel <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*centrality,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
imodel1 <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
imodel2 <- map(alist(
victim ~ dbinom(1, p),
logit(p) <- a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*density,
a ~ dnorm(0,10),
b1 ~ dnorm(0,10),
b2 ~ dnorm(0,10),
b3 ~ dnorm(0,10),
b4 ~ dnorm(0,10),
b5 ~ dnorm(0,10),
b6 ~ dnorm(0,10)), data=mydata.c, start=list(b1=0, b2=0, b3=0, b4=0, b5=0, b6=0))
#New data frame with variables held constant - Interaction terms held at quantiles
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
popularity <- mean(mydata.c$popularity, na.rm = T)
centrality <- quantile(mydata.c$centrality, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel1@coef, Sigma = imodel1@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
#Visualize: Centrality Interactions
samples$centrality <- as.character(samples$centrality)
samples <- samples %>%
mutate(Centrality = case_when(
centrality == "0" ~ "10th Percentile",
centrality == "0.7867627910904" ~ "50th Percentile",
centrality == "1.70167438806094"  ~ "90th Percentile",
T ~ NA_character_))
samples$Centrality <- as.factor(samples$Centrality)
ggplot(samples, aes(x = network.delinquency , group = Centrality)) +
geom_smooth(aes(y = victim, color = Centrality) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
popularity <- quantile(mydata.c$popularity, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel1@coef, Sigma = imodel1@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
View(samples)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
popularity <- quantile(mydata.c$popularity, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
View(predictions)
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
sample <- MASS::mvrnorm(mu = imodel1@coef, Sigma = imodel1@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
View(sample)
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, centrality) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
View(samples)
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, populairty) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, popularity) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
samples <- samples %>%
mutate(Popularity = case_when(
popularity == 1 ~ "10th Percentile",
popularity == 4 ~ "50th Percentile",
popularity == 10  ~ "90th Percentile",
T ~ NA_character_))
samples$Popularity <- as.factor(samples$Popularity)
ggplot(samples, aes(x = network.delinquency , group = Popularity)) +
geom_smooth(aes(y = victim, color = Popularity) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
#New data frame with variables held constant - Interaction terms held at quantiles
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
popularity <- quantile(mydata.c$popularity, c(.1, .5, .9))
density <- mean(mydata.c$density, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel1@coef, Sigma = imodel1@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*popularity) %>%
group_by(network.delinquency, popularity) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
#Visualize: Centrality Interactions
samples <- samples %>%
mutate(Popularity = case_when(
popularity == 1 ~ "10th Percentile",
popularity == 4 ~ "50th Percentile",
popularity == 10  ~ "90th Percentile",
T ~ NA_character_))
samples$Popularity <- as.factor(samples$Popularity)
ggplot(samples, aes(x = network.delinquency , group = Popularity)) +
geom_smooth(aes(y = victim, color = Popularity) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
density <- quantile(mydata.c$density, c(.1, .5, .9))
popularity <- mean(mydata.c$popularity, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
samples <- samples %>%
mutate(Density = case_when(
density == .157 ~ "10th Percentile",
density == .262 ~ "50th Percentile",
density == .5  ~ "90th Percentile",
T ~ NA_character_))
View(samples)
weapon.carry <- mean(mydata.c$weapon.carry, na.rm = T)
network.delinquency <- seq(0, 5, by = .1)
centrality <- mean(mydata.c$centrality, na.rm = T)
density <- quantile(mydata.c$density, c(.1, .5, .9))
popularity <- mean(mydata.c$popularity, na.rm = T)
predictions <- as.tibble(expand.grid(weapon.carry, network.delinquency, popularity, centrality, density))
colnames(predictions) <- c("weapon.carry", "network.delinquency", "popularity", "centrality", "density")
predictions$joinby <- seq(1:nrow(predictions))
N <- 1e4
dim <- nrow(predictions)
#Predicted Likelihood of Victimization added to the newdata
sample <- MASS::mvrnorm(mu = imodel2@coef, Sigma = imodel2@vcov, n = dim*N ) %>%
as.tibble %>% mutate(joinby = rep(1:dim, N))
samples <- full_join(sample, predictions, by = "joinby") %>%
mutate(victim = a + b1*weapon.carry + b2*network.delinquency + b3*popularity + b4*centrality + b5*density + b6*network.delinquency*density) %>%
group_by(network.delinquency, density) %>%
mutate(mu = mean(victim),
lb.mu = HPDI(victim, prob = .89)[1],
ub.mu = HPDI(victim, prob = .89)[2]) %>%
slice(1)
View(samples)
samples$density <- as.character(samples$density)
samples <- samples %>%
mutate(Density = case_when(
density == "0.1571428571429" ~ "10th Percentile",
density == "0.2619047619048" ~ "50th Percentile",
density == "0.5"  ~ "90th Percentile",
T ~ NA_character_))
samples$density <- as.factor(samples$density)
ggplot(samples, aes(x = network.delinquency , group = density)) +
geom_smooth(aes(y = victim, color = density) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
ggplot(samples, aes(x = network.delinquency , group = Density)) +
geom_smooth(aes(y = mu, color = Density) , method = "lm" ) +
geom_ribbon(aes(ymin = lb.mu , ymax = ub.mu) , alpha = .2)  +
labs(title = "Adolescent Victimization", x = "Average Delinquency in Friendship Network", y = "Likelihood of Victimization")
